<index.html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mermaid Homes - Your Gateway to Phuket Real Estate</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Chart.js CDN for the ROI calculator -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* --- CORE STYLES --- */
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: 'Josefin Sans', sans-serif;
            color: #5d4037; /* Main text color */
        }
        .container {
            max-width: 1200px;
        }

        /* --- LOADING OVERLAY (IMPROVED) --- */
        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 1;
            visibility: visible;
            transition: opacity 0.5s ease-out, visibility 0.5s ease-out;
        }
        #loading-overlay.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }
        #loading-overlay img {
            max-width: 150px;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(0.95); }
            70% { transform: scale(1); }
            100% { transform: scale(0.95); }
        }

        /* --- SPA NAVIGATION: Page Visibility --- */
        .page-content-section {
            display: none; /* Hide all sections by default */
        }
        .page-content-section.active {
            display: block; /* Show only the active section */
        }
        
        /* --- HERO SECTION --- */
        .hero-background {
            background: linear-gradient(135deg, #8d6e63 0%, #a1887f 100%);
            position: relative;
            overflow: hidden;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 4rem 1rem;
            min-height: 600px;
        }
        .hero-background::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="waves" x="0" y="0" width="100" height="100" patternUnits="userSpaceOnUse"><path d="M0 50 Q25 25 50 50 T100 50 V100 H0 Z" fill="rgba(255,255,255,0.1)"/></pattern></defs><rect width="100" height="100" fill="url(%23waves)"/></svg>') repeat;
            opacity: 0.3;
        }

        /* --- UI & ANIMATIONS --- */
        .floating-animation {
            animation: float 6s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        .wave-decoration {
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120"><path d="M0,0V46.29c47.79,22.2,103.59,32.17,158,28,70.36-5.37,136.33-33.31,206.8-37.5C438.64,32.43,512.34,53.67,583,72.05c69.27,18,138.3,24.88,209.4,13.08,36.15-6,69.85-17.84,104.45-29.34C989.49,25,1113-14.29,1200,52.47V0Z" opacity=".25" fill="%23d7ccc8"/><path d="M0,0V15.81C13,36.92,27.64,56.86,47.69,72.05,99.41,111.27,165,111,224.58,91.58c31.15-10.15,60.09-26.07,89.67-39.8,40.92-19,84.73-46,130.83-49.67,36.26-2.85,70.9,9.42,98.6,31.56,31.77,25.39,62.32,62,103.63,73,40.44,10.79,81.35-6.69,119.13-24.28s75.16-39,116.92-43.05c59.73-5.85,113.28,22.88,168.9,38.84,30.2,8.66,59,6.17,87.09-7.5,22.43-10.89,48-26.93,60.65-49.24V0Z" opacity=".5" fill="%23d7ccc8"/><path d="M0,0V5.63C149.93,59,314.09,71.32,475.83,42.57c43-7.64,84.23-20.12,127.61-26.46,59-8.63,112.48,12.24,165.56,35.4C827.93,77.22,886,95.24,951.2,90c86.53-7,172.46-45.71,248.8-84.81V0Z" fill="%23d7ccc8"/></svg>') no-repeat center bottom;
            background-size: cover;
            padding-bottom: 60px;
        }

        /* --- CUSTOM COLORS --- */
        .beige-primary { background-color: #d7ccc8; }
        .beige-secondary { background-color: #efebe9; }
        .beige-dark { background-color: #8d6e63; }
        .beige-light { background-color: #f5f5f5; }
        .text-beige-dark { color: #5d4037; }
        .text-beige-medium { color: #8d6e63; }
        .border-beige { border-color: #d7ccc8; }
        .mermaid-accent { background: linear-gradient(135deg, #4db6ac, #26a69a); }
        .mermaid-accent-text { color: #26a69a; }
        .text-teal-600 { color: #5d4037; } /* Changed for better theme consistency */
        .hover\:text-teal-200:hover { color: #d7ccc8; }
        
        /* --- CUSTOM SCROLLBAR --- */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #efebe9; border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: #8d6e63; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #5d4037; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }

        /* --- FLOATING BUTTONS & WIDGETS --- */
        .currency-toggle {
            position: fixed;
            top: 100px;
            right: 20px;
            z-index: 1000;
            background: rgba(215, 204, 200, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .add-listing-btn, .whatsapp-float {
            position: fixed;
            bottom: 30px;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            color: white;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            transition: all 0.3s ease;
        }
        .add-listing-btn {
            right: 30px;
            background: linear-gradient(135deg, #4db6ac, #26a69a);
            box-shadow: 0 4px 20px rgba(77, 182, 172, 0.4);
        }
        .add-listing-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(77, 182, 172, 0.6);
        }
        .whatsapp-float {
            left: 30px;
            background: #8d6e63;
            box-shadow: 0 4px 20px rgba(141, 110, 99, 0.4);
        }
        .whatsapp-float:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 25px rgba(141, 110, 99, 0.6);
        }

        /* --- PROPERTY CARD STYLES --- */
        .property-card {
            background: linear-gradient(145deg, #ffffff, #f5f5f5);
            border: 1px solid #d7ccc8;
            border-radius: 16px;
            overflow: hidden;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(141, 110, 99, 0.1);
        }
        .property-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 30px rgba(141, 110, 99, 0.2);
        }

        /* --- MODAL STYLES (IMPROVED) --- */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            backdrop-filter: blur(5px);
            align-items: center;
            justify-content: center;
        }
        .modal.active {
            display: flex;
        }
        .modal-content {
            background: white;
            border-radius: 16px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 8px 30px rgba(0,0,0,0.2);
            transform: scale(0.9);
            opacity: 0;
        }
        .modal.active .modal-content {
            animation: modal-enter 0.3s forwards ease-out;
        }
        .modal.leaving .modal-content {
            animation: modal-leave 0.3s forwards ease-in;
        }
        @keyframes modal-enter {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        @keyframes modal-leave {
            from { transform: scale(1); opacity: 1; }
            to { transform: scale(0.9); opacity: 0; }
        }
        .image-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        .image-preview img {
            width: 80px;
            height: 80px;
            object-fit: cover;
            border-radius: 8px;
            border: 2px solid #d7ccc8;
        }
        
        /* --- PROPERTY DETAIL MODAL --- */
        .property-detail-modal {
            z-index: 3000; /* Higher index than the other modal */
        }
        .property-detail-content {
             max-width: 900px;
        }
        .image-gallery {
            position: relative;
            width: 100%;
            height: 400px; /* Fixed height for gallery */
            overflow: hidden;
            border-radius: 8px;
            margin-bottom: 20px;
            background-color: #eee;
        }
        .image-gallery img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
            top: 0; left: 0;
            opacity: 0;
            transition: opacity 0.4s ease-in-out;
        }
        .image-gallery img.active {
            opacity: 1;
        }
        .gallery-nav-button {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0,0,0,0.5);
            color: white;
            padding: 10px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            z-index: 10;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .gallery-nav-button:hover { background: rgba(0,0,0,0.7); }
        .gallery-nav-button.left { left: 10px; }
        .gallery-nav-button.right { right: 10px; }
        .property-details-grid {
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: 16px;
        }
        @media (min-width: 768px) {
            .property-details-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* --- SEARCH FILTERS & MAP --- */
        .search-filter-container {
            background-color: white;
            border-radius: 16px;
            box-shadow: 0 4px 15px rgba(141, 110, 99, 0.1);
            padding: 24px;
            margin-bottom: 32px;
            display: grid;
            gap: 16px;
            grid-template-columns: repeat(1, 1fr);
        }
        @media (min-width: 640px) { .search-filter-container { grid-template-columns: repeat(2, 1fr); } }
        @media (min-width: 1024px) { .search-filter-container { grid-template-columns: repeat(3, 1fr); } }
        @media (min-width: 1280px) { .search-filter-container { grid-template-columns: repeat(6, 1fr); } }
        .search-filter-container select,
        .search-filter-container input[type="text"],
        .search-filter-container input[type="number"] {
            width: 100%; padding: 10px; border: 1px solid #d7ccc8;
            border-radius: 8px; background-color: #efebe9; color: #5d4037;
            font-family: 'Josefin Sans', sans-serif;
        }
        .search-filter-container select:focus,
        .search-filter-container input:focus {
            outline: none; border-color: #8d6e63;
            box-shadow: 0 0 0 2px rgba(141, 110, 99, 0.2);
        }
        .search-filter-container label {
            display: block; margin-bottom: 4px; font-weight: 500; color: #5d4037;
        }
        #map {
            width: 100%; height: 70vh; border-radius: 1rem;
            margin-top: 2rem; box-shadow: 0 4px 15px rgba(141, 110, 99, 0.1);
            background-color: #eee;
        }

        /* --- ROI CALCULATOR CHART --- */
        #roiChartContainer {
            width: 100%; max-width: 400px; margin: 20px auto;
            height: 200px; position: relative;
        }
    </style>
</head>
<body class="beige-light">

    <!-- Loading Overlay -->
    <div id="loading-overlay">
        <img src="logo1.jpg" alt="Mermaid Homes Logo" onerror="this.onerror=null;this.src='https://placehold.co/150x150/d7ccc8/5d4037?text=Logo';">
        <div class="text-beige-dark text-xl font-semibold">Loading Mermaid Homes...</div>
    </div>

    <!-- Currency Toggle -->
    <div class="currency-toggle">
        <div class="flex items-center space-x-2">
            <button id="currency-toggle" class="text-beige-dark font-medium px-3 py-1 rounded-full hover:bg-white transition-colors">
                <span id="current-currency">THB</span>
            </button>
        </div>
    </div>

    <!-- Header & Navigation -->
    <header class="bg-white shadow-sm py-4 sticky top-0 z-50 border-b border-beige">
        <div class="container mx-auto px-4 flex justify-between items-center">
            <a href="#hero-section" class="flex items-center space-x-3 nav-link">
                <img src="logo1.jpg" alt="Mermaid Homes Logo" class="h-10 w-auto" onerror="this.onerror=null;this.src='https://placehold.co/40x40/d7ccc8/5d4037?text=M';"> 
                <div>
                    <span class="text-2xl font-bold text-beige-dark">Mermaid Homes</span>
                    <p class="text-xs text-beige-medium">Phuket, Thailand</p>
                </div>
            </a>
            <nav class="hidden md:flex space-x-6">
                <a href="#services" class="text-beige-medium hover:text-beige-dark font-medium transition duration-300 nav-link">Services</a>
                <a href="#properties" class="text-beige-medium hover:text-beige-dark font-medium transition duration-300 nav-link">Properties</a>
                <a href="#post-property-listing" class="text-beige-medium hover:text-beige-dark font-medium transition duration-300 nav-link">Post Property</a>
                <a href="#roi-calculator" class="text-beige-medium hover:text-beige-dark font-medium transition duration-300 nav-link">ROI Calc</a>
                <a href="#projects" class="text-beige-medium hover:text-beige-dark font-medium transition duration-300 nav-link">Projects</a>
                <a href="#google-map-section" class="text-beige-medium hover:text-beige-dark font-medium transition duration-300 nav-link">Explore Map</a>
                <a href="#communities" class="text-beige-medium hover:text-beige-dark font-medium transition duration-300 nav-link">Areas</a>
                <a href="#testimonials" class="text-beige-medium hover:text-beige-dark font-medium transition duration-300 nav-link">Reviews</a>
                <a href="#contact" class="text-beige-medium hover:text-beige-dark font-medium transition duration-300 nav-link">Contact</a>
            </nav>
            <button id="mobile-menu-button" class="md:hidden text-beige-medium hover:text-beige-dark focus:outline-none">
                <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path>
                </svg>
            </button>
        </div>
        <div id="mobile-menu" class="hidden md:hidden bg-white py-2 shadow-lg border-t border-beige">
            <nav class="flex flex-col items-center space-y-3">
                 <a href="#services" class="nav-link text-beige-dark hover:text-beige-medium font-medium py-2 w-full text-center transition duration-300">Services</a>
                 <!-- ... add nav-link class to all mobile links ... -->
            </nav>
        </div>
    </header>

    <main id="main-content">
        <!-- Home Page Section -->
        <section id="hero-section" class="page-content-section hero-background relative w-full flex">
             <div class="absolute inset-0 bg-gradient-to-r from-black/40 to-black/20"></div>
             <div id="video-section" class="relative z-10 w-full max-w-3xl mb-8">
                <div style="padding:56.25% 0 0 0;position:relative; border-radius: 8px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
                    <iframe src="https://player.vimeo.com/video/1092843113?autoplay=1&loop=1&muted=1&playsinline=1&title=0&byline=0&portrait=0"
                            style="position:absolute;top:0;left:0;width:100%;height:100%;"
                            frameborder="0"
                            allow="autoplay; fullscreen; picture-in-picture"
                            allowfullscreen>
                    </iframe>
                </div>
                <script src="https://player.vimeo.com/api/player.js"></script>
            </div>
             <div class="relative z-10 max-w-3xl floating-animation">
                <h1 class="text-4xl md:text-6xl font-bold mb-6 leading-tight">Find Your Dream Home in Phuket</h1>
                <p class="text-xl md:text-2xl mb-8 text-gray-100">Discover stunning villas, beachfront properties, and luxury condos in Thailand's tropical paradise.</p>
                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                    <a href="#properties" class="nav-link bg-white text-beige-dark font-semibold py-4 px-8 rounded-full shadow-lg transition duration-300 ease-in-out transform hover:scale-105 hover:shadow-xl">Browse Properties</a>
                    <a href="#contact" class="nav-link border-2 border-white text-white font-semibold py-4 px-8 rounded-full hover:bg-white hover:text-beige-dark transition duration-300 ease-in-out transform hover:scale-105">Get Started</a>
                </div>
            </div>
        </section>

        <!-- Services Page Section -->
        <section id="services" class="page-content-section py-16 bg-white">
            <!-- Content for services -->
        </section>
        
        <!-- Properties Page Section -->
        <section id="properties" class="page-content-section py-16 beige-secondary">
             <div class="container mx-auto px-4">
                <h2 class="text-4xl font-bold text-center mb-12 text-beige-dark">Featured Properties</h2>
                <div class="search-filter-container">
                    <!-- Filter inputs here -->
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" id="properties-grid">
                    <!-- Property cards will be dynamically inserted here -->
                </div>
            </div>
        </section>

        <!-- Post Your Property Listing Section (Now inside the modal, this section acts as a placeholder if needed) -->
        <section id="post-property-listing" class="page-content-section py-16 bg-white">
            <div class="container mx-auto px-4 text-center">
                 <h2 class="text-4xl font-bold text-center mb-12 text-beige-dark">Post Your Property Listing</h2>
                 <p class="max-w-xl mx-auto text-beige-medium mb-8">Ready to list your property? Click the floating '+' button to open the submission form and reach thousands of potential buyers and renters.</p>
                 <button id="open-listing-form-from-page" class="mermaid-accent text-white font-semibold py-3 px-8 rounded-md hover:opacity-90 transition duration-300">
                    Open Listing Form
                 </button>
            </div>
        </section>
        
        <!-- Other sections: ROI Calculator, Projects, Map, Communities, Testimonials, Contact -->
        <section id="roi-calculator" class="page-content-section py-16 beige-secondary">
             <!-- ROI Calculator content -->
        </section>
        <section id="projects" class="page-content-section py-16 bg-white">
             <!-- Projects content -->
        </section>
        <section id="google-map-section" class="page-content-section py-16 beige-secondary text-center flex flex-col items-center">
             <!-- Google Map content -->
        </section>
        <section id="communities" class="page-content-section py-16 bg-white">
            <!-- Communities content -->
        </section>
        <section id="testimonials" class="page-content-section py-16 beige-secondary">
             <!-- Testimonials content -->
        </section>
        <section id="contact" class="page-content-section py-16 beige-dark text-white">
             <!-- Contact content -->
        </section>
    </main>

    <footer class="bg-gray-800 text-white py-8">
        <!-- Footer content -->
    </footer>

    <!-- Add Listing Button -->
    <button id="add-listing-btn" class="add-listing-btn relative">
         <svg class="h-8 w-8" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
    </button>
    
    <!-- WhatsApp Floating Button -->
    <a href="https://wa.me/66654765114" target="_blank" class="whatsapp-float">
        <i class="fab fa-whatsapp"></i>
    </a>
    
    <!-- MODALS (Added missing HTML structure) -->
    
    <!-- Add Listing Modal -->
    <div id="add-listing-modal" class="modal">
        <div class="modal-content p-6">
            <h3 class="text-2xl font-bold text-beige-dark mb-4">Submit Your Property</h3>
            <form id="submit-property-form" class="space-y-4">
                <!-- All form inputs from original JS are assumed here -->
                 <div>
                    <label for="listing-title" class="block text-beige-dark text-sm font-semibold mb-2">Property Title</label>
                    <input name="listing-title" type="text" placeholder="e.g., Luxury Sea View Villa" required class="w-full p-3 border border-beige rounded-md focus:outline-none focus:ring-2 focus:ring-beige-dark"/>
                </div>
                <!-- ... other form fields like price, location, etc. ... -->
                 <div>
                    <label for="listing-image-files" class="block text-beige-dark text-sm font-semibold mb-2">Property Images (max 15)</label>
                    <input name="listing-image-files" type="file" id="listing-image-files" class="w-full p-3 border border-beige rounded-md" accept="image/*" multiple>
                    <div id="image-preview" class="image-preview mt-2"></div>
                </div>

                <div class="flex justify-end space-x-4 pt-4">
                    <button type="button" id="cancel-listing-btn" class="bg-gray-200 text-gray-700 font-semibold py-2 px-6 rounded-md hover:bg-gray-300">Cancel</button>
                    <button type="submit" class="mermaid-accent text-white font-semibold py-2 px-6 rounded-md hover:opacity-90">Submit Listing</button>
                </div>
                 <p id="listing-status-message" class="mt-4 text-center font-medium"></p>
            </form>
        </div>
    </div>
    
    <!-- Property Detail Modal -->
    <div id="property-detail-modal" class="modal property-detail-modal">
        <div class="property-detail-content modal-content">
             <button id="close-detail-modal" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 z-20 text-3xl">&times;</button>
             <div class="image-gallery">
                <div id="detail-image-container" class="relative w-full h-full">
                    <!-- Images will be injected here by JS -->
                </div>
                <button id="gallery-prev" class="gallery-nav-button left"><i class="fas fa-chevron-left"></i></button>
                <button id="gallery-next" class="gallery-nav-button right"><i class="fas fa-chevron-right"></i></button>
            </div>
            <div class="p-6">
                <h2 id="detail-title" class="text-3xl font-bold text-beige-dark mb-2"></h2>
                <p class="text-teal-600 font-bold text-2xl mb-4">
                    <span class="detail-price-thb"></span>
                    <span class="detail-price-usd hidden"></span>
                </p>
                <div class="property-details-grid mb-6">
                    <div><strong class="text-beige-dark">Location:</strong> <span id="detail-location"></span></div>
                    <div><strong class="text-beige-dark">Type:</strong> <span id="detail-type"></span></div>
                    <div><strong class="text-beige-dark">Bedrooms:</strong> <span id="detail-bedrooms"></span></div>
                    <div><strong class="text-beige-dark">Bathrooms:</strong> <span id="detail-bathrooms"></span></div>
                    <div><strong class="text-beige-dark">Area:</strong> <span id="detail-area"></span></div>
                    <div><strong class="text-beige-dark">Contact:</strong> <span id="detail-agent-contact"></span></div>
                </div>
                <h3 class="text-xl font-semibold text-beige-dark mb-2">Description</h3>
                <p id="detail-description" class="text-beige-medium mb-6"></p>
                <h3 class="text-xl font-semibold text-beige-dark mb-2">Facilities</h3>
                <ul id="detail-facilities" class="list-disc list-inside text-beige-medium space-y-1"></ul>
                 <a id="detail-contact-whatsapp" href="#" target="_blank" class="mt-6 inline-block w-full text-center bg-green-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-600 transition-colors">
                    <i class="fab fa-whatsapp mr-2"></i>Contact Agent
                 </a>
            </div>
        </div>
    </div>


    <script>
    // --- SCRIPT INITIALIZATION (DOM Listener at the bottom) ---
    document.addEventListener('DOMContentLoaded', () => {

        // --- GLOBAL VARIABLES & CONSTANTS ---
        const GOOGLE_MAPS_API_KEY = 'YOUR_GOOGLE_MAPS_API_KEY'; // IMPORTANT: Replace with your actual API key
        const USD_EXCHANGE_RATE = 36.5;

        // --- DOM ELEMENT SELECTORS ---
        const loadingOverlay = document.getElementById('loading-overlay');
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        const currencyToggleButton = document.getElementById('currency-toggle');
        const allPageSections = document.querySelectorAll('.page-content-section');
        const navLinks = document.querySelectorAll('.nav-link');
        const propertiesGrid = document.getElementById('properties-grid');
        
        // Add Listing Modal Elements
        const addListingBtn = document.getElementById('add-listing-btn');
        const openListingFormBtn = document.getElementById('open-listing-form-from-page');
        const addListingModal = document.getElementById('add-listing-modal');
        const cancelListingBtn = document.getElementById('cancel-listing-btn');
        const submitPropertyForm = document.getElementById('submit-property-form');
        const propertyImageInput = document.getElementById('listing-image-files');
        const imagePreviewContainer = document.getElementById('image-preview');
        const listingStatusMessage = document.getElementById('listing-status-message');
        
        // Property Detail Modal Elements
        const propertyDetailModal = document.getElementById('property-detail-modal');
        const closeDetailModalBtn = document.getElementById('close-detail-modal');
        const detailTitle = document.getElementById('detail-title');
        const detailImageContainer = document.getElementById('detail-image-container');
        const galleryPrevBtn = document.getElementById('gallery-prev');
        const galleryNextBtn = document.getElementById('gallery-next');
        const detailBedrooms = document.getElementById('detail-bedrooms');
        const detailBathrooms = document.getElementById('detail-bathrooms');
        const detailArea = document.getElementById('detail-area');
        const detailLocation = document.getElementById('detail-location');
        const detailType = document.getElementById('detail-type');
        const detailDescription = document.getElementById('detail-description');
        const detailFacilities = document.getElementById('detail-facilities');
        const detailContactWhatsapp = document.getElementById('detail-contact-whatsapp');
        const detailAgentContact = document.getElementById('detail-agent-contact');

        // --- STATE VARIABLES ---
        let isTHB = true;
        let map;
        let geocoder;
        let marker;
        let currentDetailImages = [];
        let currentImageIndex = 0;
        let roiChartInstance = null;
        
        // Sample data - replace with your actual data source (e.g., API, Firebase)
        const propertiesData = [
            // Your propertiesData array from original script goes here...
            {
                id: 'villa-kamala-1', title: 'Luxury Beachfront Villa', location: 'Kamala Beach', type: 'Sale',
                bedrooms: 4, bathrooms: 5, area: 350, priceTHB: 45000000,
                description: 'Stunning luxury villa on Kamala Beach with breathtaking sea views.',
                facilities: ['Large Private Pool', 'Beach Access', 'Fully Equipped Kitchen', '24/7 Security'],
                images: ['https://placehold.co/800x600/4db6ac/ffffff?text=Luxury+Villa+1', 'https://placehold.co/800x600/4db6ac/ffffff?text=Luxury+Villa+2'],
                agentContact: '+66123456789'
            },
            {
                id: 'trichada-villa-rent', title: 'Trichada Pool Villa for Rent', location: 'Phuket', type: 'Rent',
                bedrooms: 3, bathrooms: 2, landPlot: 300, area: 200, priceTHB: 170000,
                description: 'Spacious pool villa with 3 bedrooms & 2 bathrooms, move-in ready!',
                facilities: ['Private Pool', 'Garden & Pool Cleaning Included', 'Common Fee Included', 'Move-in Ready'],
                images: ['T0.jpg', 'T1.jpg', 'T2.jpg', 'T3.jpg', 'T4.jpg', 'T5.jpg', 'T6.jpg', 'T7.jpg', 'T8.jpg', 'T10.jpg', 'T11.jpg', 'T12.jpg', 'T13.jpg'],
                agentContact: '+66654765114'
            }
        ];

        // --- FUNCTIONS ---
        
        /**
         * Hides the loading overlay with a smooth transition.
         */
        function hideLoader() {
            if (loadingOverlay) {
                loadingOverlay.classList.add('hidden');
            }
        }
        
        /**
         * Handles SPA-like navigation by showing the target section.
         * @param {string} pageId - The ID of the section to show.
         */
        function showPage(pageId) {
            allPageSections.forEach(section => {
                section.style.display = (section.id === pageId) ? 'block' : 'none';
            });
            // Optional: Scroll to the top of the section
            document.getElementById(pageId)?.scrollIntoView({ behavior: 'smooth' });
        }
        
        /**
         * Renders property cards into the grid.
         * @param {Array} propertiesToRender - An array of property objects.
         */
        function renderPropertyCards(propertiesToRender) {
            propertiesGrid.innerHTML = '';
            if (propertiesToRender.length === 0) {
                propertiesGrid.innerHTML = `<p class="col-span-full text-center text-beige-medium">No properties match your criteria.</p>`;
                return;
            }
            propertiesToRender.forEach(property => {
                const priceTextTHB = property.type === 'Rent' ? `฿${property.priceTHB.toLocaleString()}/month` : `฿${property.priceTHB.toLocaleString()}`;
                const priceTextUSD = property.type === 'Rent' ? `$${(property.priceTHB / USD_EXCHANGE_RATE).toFixed(0).toLocaleString()}/month` : `$${(property.priceTHB / USD_EXCHANGE_RATE).toFixed(0).toLocaleString()}`;
                
                const cardHTML = `
                    <div class="property-card" data-id="${property.id}">
                        <img src="${property.images[0] || 'https://placehold.co/600x400/cccccc/333333?text=No+Image'}" alt="${property.title}" class="w-full h-48 object-cover" onerror="this.onerror=null;this.src='https://placehold.co/600x400/cccccc/333333?text=Image+Error';">
                        <div class="p-6">
                            <h3 class="text-xl font-semibold mb-2 text-beige-dark">${property.title}</h3>
                            <p class="font-bold text-lg mb-3">
                                <span class="price-thb">${priceTextTHB}</span>
                                <span class="price-usd hidden">${priceTextUSD}</span>
                            </p>
                            <ul class="text-beige-medium text-sm space-y-1 mb-4">
                                <li><strong>Bedrooms:</strong> ${property.bedrooms}</li>
                                <li><strong>Area:</strong> ${property.area} sqm</li>
                                <li><strong>Location:</strong> ${property.location}</li>
                            </ul>
                            <button class="view-details-btn w-full mermaid-accent text-white font-semibold py-3 px-4 rounded-lg transition duration-300">View Details</button>
                        </div>
                    </div>
                `;
                propertiesGrid.insertAdjacentHTML('beforeend', cardHTML);
            });
            attachViewDetailsListeners();
            updateCurrencyDisplay();
        }
        
        /**
         * Updates all price displays based on the current currency selection (THB/USD).
         */
        function updateCurrencyDisplay() {
             const thbElements = document.querySelectorAll('.price-thb');
             const usdElements = document.querySelectorAll('.price-usd');
             thbElements.forEach(el => el.classList.toggle('hidden', !isTHB));
             usdElements.forEach(el => el.classList.toggle('hidden', isTHB));
        }

        /**
         * Toggles the currency between THB and USD.
         */
        function toggleCurrency() {
            isTHB = !isTHB;
            document.getElementById('current-currency').textContent = isTHB ? 'THB' : 'USD';
            updateCurrencyDisplay();
        }
        
        /**
         * Attaches click listeners to all "View Details" buttons.
         */
        function attachViewDetailsListeners() {
            document.querySelectorAll('.view-details-btn').forEach(button => {
                button.addEventListener('click', (event) => {
                    const propertyId = event.target.closest('.property-card').dataset.id;
                    const property = propertiesData.find(p => p.id === propertyId);
                    if (property) {
                        showPropertyDetailModal(property);
                    }
                });
            });
        }

        /**
         * Shows the modal with details of a specific property.
         * @param {object} property - The property object to display.
         */
        function showPropertyDetailModal(property) {
            // Populate modal with property data
            detailTitle.textContent = property.title;
            detailBedrooms.textContent = property.bedrooms;
            // ... populate other fields ...
            const whatsappNumber = (property.agentContact || '').replace(/\D/g, ''); // Sanitize phone number
            detailContactWhatsapp.href = `https://wa.me/${whatsappNumber}`;

            // Image gallery setup
            detailImageContainer.innerHTML = '';
            currentDetailImages = property.images;
            currentImageIndex = 0;
            if (currentDetailImages.length > 0) {
                updateGalleryImage();
                galleryPrevBtn.style.display = currentDetailImages.length > 1 ? 'flex' : 'none';
                galleryNextBtn.style.display = currentDetailImages.length > 1 ? 'flex' : 'none';
            } else {
                 detailImageContainer.innerHTML = `<img src="https://placehold.co/800x600/cccccc/333333?text=No+Image" class="active">`;
                 galleryPrevBtn.style.display = 'none';
                 galleryNextBtn.style.display = 'none';
            }

            propertyDetailModal.classList.add('active');
            propertyDetailModal.classList.remove('leaving');
        }
        
        function hidePropertyDetailModal() {
             propertyDetailModal.classList.add('leaving');
             setTimeout(() => {
                propertyDetailModal.classList.remove('active', 'leaving');
             }, 300); // Match animation duration
        }

        function updateGalleryImage() {
            detailImageContainer.innerHTML = `<img src="${currentDetailImages[currentImageIndex]}" alt="${detailTitle.textContent}" class="active" onerror="this.onerror=null;this.src='https://placehold.co/800x600/cccccc/333333?text=Image+Error';"/>`;
        }

        function navigateGallery(direction) {
            currentImageIndex = (currentImageIndex + direction + currentDetailImages.length) % currentDetailImages.length;
            updateGalleryImage();
        }
        
        /**
         * Initializes the Google Map. This is the callback function for the Maps API script.
         */
        window.initMap = function() {
            const phuketCenter = { lat: 7.8804, lng: 98.3923 };
            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 12,
                center: phuketCenter,
                gestureHandling: 'cooperative'
            });
            marker = new google.maps.Marker({ position: phuketCenter, map: map });
            geocoder = new google.maps.Geocoder();
        };

        /**
         * Dynamically loads the Google Maps script.
         */
        function loadGoogleMaps() {
            if (typeof google === 'object' && typeof google.maps === 'object') {
                initMap(); // Already loaded
            } else {
                const script = document.createElement('script');
                script.src = `https://maps.googleapis.com/maps/api/js?key=${GOOGLE_MAPS_API_KEY}&callback=initMap`;
                script.async = true;
                script.defer = true;
                document.head.appendChild(script);
            }
        }
        
        // --- EVENT LISTENERS ---

        // Robust Loading Logic
        window.addEventListener('load', () => setTimeout(hideLoader, 300)); // Primary trigger
        setTimeout(hideLoader, 500); // Initial fallback
        setTimeout(hideLoader, 3000); // Final fallback

        // Navigation
        navLinks.forEach(link => {
            link.addEventListener('click', (event) => {
                event.preventDefault();
                const pageId = link.getAttribute('href').substring(1);
                showPage(pageId);
                history.pushState({page: pageId}, '', `#${pageId}`);
                if (mobileMenu.classList.contains('hidden') === false) {
                     mobileMenu.classList.add('hidden');
                }
            });
        });
        window.addEventListener('popstate', (event) => {
            const pageId = event.state?.page || 'hero-section';
            showPage(pageId);
        });
        mobileMenuButton.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));
        
        // Currency Toggle
        currencyToggleButton.addEventListener('click', toggleCurrency);

        // Modals
        const openModalAction = () => {
             addListingForm.reset();
             imagePreviewContainer.innerHTML = '';
             addListingModal.classList.add('active');
        };
        addListingBtn.addEventListener('click', openModalAction);
        openListingFormBtn.addEventListener('click', openModalAction);
        cancelListingBtn.addEventListener('click', () => addListingModal.classList.add('leaving'));
        addListingModal.addEventListener('click', (e) => { if (e.target === addListingModal) addListingModal.classList.add('leaving'); });
        
        closeDetailModalBtn.addEventListener('click', hidePropertyDetailModal);
        propertyDetailModal.addEventListener('click', (e) => { if (e.target === propertyDetailModal) hidePropertyDetailModal(); });
        galleryPrevBtn.addEventListener('click', () => navigateGallery(-1));
        galleryNextBtn.addEventListener('click', () => navigateGallery(1));


        // --- INITIALIZATION CALLS ---
        
        // Initial page setup based on URL hash
        const initialPageId = window.location.hash.substring(1) || 'hero-section';
        showPage(initialPageId);
        
        // Initial render of properties
        renderPropertyCards(propertiesData);

        // Load Google Maps script
        loadGoogleMaps();

    });
    </script>
</body>
</html>
