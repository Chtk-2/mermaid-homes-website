<script>
// Moved to bottom of <body> so DOM is ready

// Global map variables
let map, geocoder, marker;

function initMap() {
  const phuketCenter = { lat: 7.8804, lng: 98.3923 };
  map = new google.maps.Map(document.getElementById('map'), {
    zoom: 12,
    center: phuketCenter,
    gestureHandling: 'cooperative'
  });

  marker = new google.maps.Marker({
    position: phuketCenter,
    map,
    title: 'Phuket'
  });

  geocoder = new google.maps.Geocoder();
  const searchInput = document.getElementById('map-search-input');
  const searchButton = document.getElementById('map-search-button');

  searchButton.addEventListener('click', () => handleSearch(map, searchInput.value));
  searchInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') handleSearch(map, searchInput.value);
  });
}

function handleSearch(mapInstance, address) {
  geocoder.geocode({ address: address + ", Phuket, Thailand" }, (results, status) => {
    if (status === 'OK' && results[0]) {
      const location = results[0].geometry.location;
      mapInstance.setCenter(location);
      marker.setPosition(location);
      mapInstance.setZoom(15);
    } else {
      console.error('Geocode failed:', status);
      alert('Location not found. Try a more specific Phuket location.');
    }
  });
}

window.addEventListener('DOMContentLoaded', () => {
  const loadingOverlay = document.getElementById('loading-overlay');
  if (loadingOverlay) {
    setTimeout(() => {
      loadingOverlay.classList.add('hidden');
    }, 500);
  }

  const googleMapsApiKey = 'YOUR_GOOGLE_MAPS_API_KEY';
  const script = document.createElement('script');
  script.src = `https://maps.googleapis.com/maps/api/js?key=${googleMapsApiKey}&libraries=places&callback=initMap`;
  script.async = true;
  script.defer = true;
  script.onerror = () => console.error('Google Maps API failed to load.');
  document.head.appendChild(script);
});
</script>
