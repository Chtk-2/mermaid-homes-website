<index.html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mermaid Homes - Your Gateway to Phuket Real Estate</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Chart.js CDN for the ROI calculator -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* --- CORE STYLES --- */
        html { scroll-behavior: smooth; }
        body { font-family: 'Josefin Sans', sans-serif; color: #5d4037; }
        .container { max-width: 1200px; }

        /* --- LOADING OVERLAY --- */
        #loading-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(255, 255, 255, 0.95); display: flex;
            flex-direction: column; align-items: center; justify-content: center;
            z-index: 9999; opacity: 1; visibility: visible;
            transition: opacity 0.5s ease-out, visibility 0.5s ease-out;
        }
        #loading-overlay.hidden { opacity: 0; visibility: hidden; pointer-events: none; }
        #loading-overlay img { max-width: 150px; animation: pulse 1.5s infinite; }
        @keyframes pulse {
            0%, 100% { transform: scale(0.95); }
            50% { transform: scale(1); }
        }

        /* --- SPA NAVIGATION: Page Visibility --- */
        .page-content-section { display: none; }
        .page-content-section.active { display: block; }
        
        /* --- HERO SECTION WITH VIDEO --- */
        .hero-background {
            position: relative; height: 85vh; min-height: 600px;
            display: flex; align-items: center; justify-content: center;
            text-align: center; color: white; overflow: hidden;
        }
        #hero-video {
            position: absolute; top: 50%; left: 50%;
            width: 100%; height: 100%;
            object-fit: cover;
            transform: translate(-50%, -50%);
            z-index: 1;
        }
        .hero-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.4); z-index: 2;
        }
        .hero-content { position: relative; z-index: 3; }

        /* --- UI & ANIMATIONS --- */
        .floating-animation { animation: float 6s ease-in-out infinite; }
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        /* --- CUSTOM COLORS --- */
        .beige-primary { background-color: #d7ccc8; }
        .beige-secondary { background-color: #efebe9; }
        .beige-dark { background-color: #8d6e63; }
        .text-beige-dark { color: #5d4037; }
        .text-beige-medium { color: #8d6e63; }
        .mermaid-accent { background: linear-gradient(135deg, #4db6ac, #26a69a); }

        /* --- FLOATING BUTTONS & WIDGETS --- */
        .currency-toggle {
            position: fixed; top: 100px; right: 20px; z-index: 1000;
            background: rgba(215, 204, 200, 0.9); backdrop-filter: blur(10px);
            border-radius: 20px; padding: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .add-listing-btn, .whatsapp-float {
            position: fixed; bottom: 30px; width: 60px; height: 60px;
            border-radius: 50%; color: white; font-size: 24px;
            display: flex; align-items: center; justify-content: center;
            z-index: 1000; transition: all 0.3s ease;
        }
        .add-listing-btn { right: 30px; background: linear-gradient(135deg, #4db6ac, #26a69a); box-shadow: 0 4px 20px rgba(77, 182, 172, 0.4); }
        .add-listing-btn:hover { transform: scale(1.1); box-shadow: 0 6px 25px rgba(77, 182, 172, 0.6); }
        .whatsapp-float { left: 30px; background: #25D366; box-shadow: 0 4px 20px rgba(37, 211, 102, 0.4); }
        .whatsapp-float:hover { transform: scale(1.1); box-shadow: 0 6px 25px rgba(37, 211, 102, 0.6); }

        /* --- PROPERTY CARD & MODAL STYLES --- */
        .property-card {
            background: #fff; border: 1px solid #d7ccc8; border-radius: 16px;
            overflow: hidden; transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(141, 110, 99, 0.1);
        }
        .property-card:hover { transform: translateY(-8px); box-shadow: 0 12px 30px rgba(141, 110, 99, 0.2); }
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); z-index: 2000; backdrop-filter: blur(5px);
            align-items: center; justify-content: center;
        }
        .modal.active { display: flex; }
        .modal-content {
            background: white; border-radius: 16px; max-width: 600px;
            width: 90%; max-height: 90vh; overflow-y: auto; position: relative;
            box-shadow: 0 8px 30px rgba(0,0,0,0.2); transform: scale(0.9); opacity: 0;
            animation: modal-enter 0.3s forwards ease-out;
        }
        .modal.leaving .modal-content { animation: modal-leave 0.3s forwards ease-in; }
        @keyframes modal-enter { to { transform: scale(1); opacity: 1; } }
        @keyframes modal-leave { from { transform: scale(1); opacity: 1; } to { transform: scale(0.9); opacity: 0; } }
        .image-preview { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; }
        .image-preview img { width: 80px; height: 80px; object-fit: cover; border-radius: 8px; border: 2px solid #d7ccc8; }
        
        /* --- PROPERTY DETAIL MODAL --- */
        .property-detail-modal { z-index: 3000; }
        .property-detail-content { max-width: 900px; }
        .image-gallery { position: relative; width: 100%; height: 400px; overflow: hidden; border-radius: 8px; margin-bottom: 20px; background-color: #eee; }
        .image-gallery img { width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0; opacity: 0; transition: opacity 0.4s ease-in-out; }
        .image-gallery img.active { opacity: 1; }
        .gallery-nav-button {
            position: absolute; top: 50%; transform: translateY(-50%); background: rgba(0,0,0,0.5);
            color: white; width: 40px; height: 40px; border-radius: 50%; cursor: pointer;
            z-index: 10; transition: background 0.3s; display: flex; align-items: center; justify-content: center;
        }
        .gallery-nav-button:hover { background: rgba(0,0,0,0.7); }
        .gallery-nav-button.left { left: 10px; }
        .gallery-nav-button.right { right: 10px; }

        /* --- ROI CALCULATOR CHART --- */
        #roiChartContainer { width: 100%; max-width: 300px; margin: 20px auto; height: 300px; }

        /* --- NOTIFICATION --- */
        #notification {
            position: fixed; top: 80px; left: 50%; transform: translateX(-50%);
            padding: 1rem 2rem; border-radius: 8px; color: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2); z-index: 9999;
            opacity: 0; visibility: hidden; transition: all 0.3s ease;
        }
        #notification.show { opacity: 1; visibility: visible; top: 100px; }
        #notification.success { background-color: #28a745; }
        #notification.error { background-color: #dc3545; }
    </style>
</head>
<body class="bg-beige-light">

    <!-- Loading Overlay -->
    <div id="loading-overlay">
        <img src="logo1.jpg" alt="Mermaid Homes Logo" onerror="this.onerror=null;this.src='https://placehold.co/150x150/d7ccc8/5d4037?text=Logo';">
        <div class="text-beige-dark text-xl font-semibold">Loading Mermaid Homes...</div>
    </div>
    
    <!-- Notification Element -->
    <div id="notification"></div>

    <!-- Currency Toggle -->
    <div class="currency-toggle">
        <button id="currency-toggle" class="text-beige-dark font-medium px-3 py-1 rounded-full hover:bg-white transition-colors">
            <span id="current-currency">THB</span>
        </button>
    </div>

    <!-- Header & Navigation -->
    <header class="bg-white shadow-sm py-4 sticky top-0 z-50 border-b border-beige">
        <!-- ... Header content from previous version ... -->
    </header>

    <main id="main-content">
        <!-- Home Page Section -->
        <section id="hero-section" class="page-content-section hero-background">
             <div class="hero-overlay"></div>
             <video autoplay loop muted playsinline id="hero-video" poster="https://placehold.co/1920x1080/8d6e63/ffffff?text=Mermaid+Homes">
                 <!-- The user should replace this src with their actual video file path -->
                 <source src="Video opening.mp4" type="video/mp4">
                 Your browser does not support the video tag.
             </video>
             <div class="hero-content floating-animation max-w-4xl px-4">
                <h1 class="text-4xl md:text-6xl font-bold mb-4 leading-tight">Real Estate Phuket</h1>
                <p class="text-2xl md:text-3xl font-light mb-6">Thailand best luxury homes | Sell and Rent üè°</p>
                <p class="text-lg md:text-xl mb-8 text-gray-200">Explore the Island‚Äôs property with us</p>
                <a href="#properties" class="nav-link bg-white text-beige-dark font-semibold py-3 px-8 rounded-full shadow-lg transition duration-300 ease-in-out transform hover:scale-105 hover:shadow-xl text-lg">
                    Browse Properties
                </a>
            </div>
        </section>

        <!-- Services Page Section -->
        <section id="services" class="page-content-section py-16 bg-white">
            <!-- Populated content -->
        </section>
        
        <!-- Properties Page Section -->
        <section id="properties" class="page-content-section py-16 beige-secondary">
             <!-- ... Properties content from previous version ... -->
        </section>

        <!-- Post Your Property Listing Section -->
        <section id="post-property-listing" class="page-content-section py-16 bg-white">
            <div class="container mx-auto px-4 text-center">
                 <h2 class="text-4xl font-bold text-center mb-12 text-beige-dark">Post Your Property Listing</h2>
                 <p class="max-w-xl mx-auto text-beige-medium mb-8">Ready to list your property? Click the floating '+' button to open the submission form and reach thousands of potential buyers and renters.</p>
                 <button id="open-listing-form-from-page" class="mermaid-accent text-white font-semibold py-3 px-8 rounded-md hover:opacity-90 transition duration-300">
                    Open Listing Form
                 </button>
            </div>
        </section>
        
        <!-- ROI Calculator Section -->
        <section id="roi-calculator" class="page-content-section py-16 beige-secondary">
             <div class="container mx-auto px-4">
                <h2 class="text-4xl font-bold text-center mb-12 text-beige-dark">Calculate Your Investment ROI</h2>
                <div class="max-w-xl mx-auto bg-white rounded-2xl shadow-md p-8">
                    <div class="space-y-4">
                        <div>
                            <label for="investment" class="block text-beige-dark text-sm font-semibold mb-2">Total Investment (THB)</label>
                            <input id="investment" type="number" placeholder="e.g., 10000000" class="w-full p-3 border border-beige-primary rounded-md focus:outline-none focus:ring-2 focus:ring-beige-dark"/>
                        </div>
                        <div>
                            <label for="income" class="block text-beige-dark text-sm font-semibold mb-2">Monthly Rental Income (THB)</label>
                            <input id="income" type="number" placeholder="e.g., 50000" class="w-full p-3 border border-beige-primary rounded-md focus:outline-none focus:ring-2 focus:ring-beige-dark"/>
                        </div>
                        <div>
                            <label for="expenses" class="block text-beige-dark text-sm font-semibold mb-2">Annual Expenses (THB)</label>
                            <input id="expenses" type="number" placeholder="e.g., 60000" class="w-full p-3 border border-beige-primary rounded-md focus:outline-none focus:ring-2 focus:ring-beige-dark" />
                        </div>
                         <p id="roi-result" class="mt-4 text-center font-semibold text-beige-dark text-2xl"></p>
                         <div id="roiChartContainer">
                            <canvas id="roiChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Other sections ... -->
    </main>

    <footer class="bg-gray-800 text-white py-8">
        <div class="container mx-auto px-4 text-center">
            <div class="flex justify-center space-x-6 mb-4">
                <a href="https://www.facebook.com/profile.php?id=61551898026585" target="_blank" class="text-gray-300 hover:text-white transition duration-300 text-2xl">
                    <i class="fab fa-facebook"></i>
                </a>
                <a href="https://www.instagram.com/merm.homes" target="_blank" class="text-gray-300 hover:text-white transition duration-300 text-2xl">
                    <i class="fab fa-instagram"></i>
                </a>
                <!-- Add other social links if needed -->
            </div>
            <p>&copy; 2024 Mermaid Homes. All rights reserved.</p>
        </div>
    </footer>

    <!-- Add Listing Button -->
    <button id="add-listing-btn" class="add-listing-btn">
         <i class="fas fa-plus"></i>
    </button>
    
    <!-- WhatsApp Floating Button -->
    <a href="https://wa.me/66654765114" target="_blank" class="whatsapp-float">
        <i class="fab fa-whatsapp"></i>
    </a>
    
    <!-- MODALS -->
    <!-- Add Listing Modal -->
    <div id="add-listing-modal" class="modal">
        <div class="modal-content p-6">
            <h3 class="text-2xl font-bold text-beige-dark mb-4">Submit Your Property</h3>
            <form id="submit-property-form" class="space-y-4">
                <!-- Form fields for property submission -->
                <div>
                    <label for="listing-title" class="block text-sm font-semibold mb-1">Property Title</label>
                    <input name="listing-title" type="text" required class="w-full p-2 border border-beige-primary rounded-md"/>
                </div>
                <div>
                    <label for="listing-price" class="block text-sm font-semibold mb-1">Price (THB)</label>
                    <input name="listing-price" type="number" required class="w-full p-2 border border-beige-primary rounded-md"/>
                </div>
                 <div>
                    <label for="listing-image-files" class="block text-sm font-semibold mb-1">Property Images (max 15)</label>
                    <input name="listing-image-files" type="file" id="listing-image-files" class="w-full p-2 border border-beige-primary rounded-md" accept="image/*" multiple>
                    <div id="image-preview" class="image-preview mt-2"></div>
                </div>

                <div class="flex justify-end space-x-4 pt-4">
                    <button type="button" id="cancel-listing-btn" class="bg-gray-200 text-gray-700 font-semibold py-2 px-6 rounded-md hover:bg-gray-300">Cancel</button>
                    <button type="submit" class="mermaid-accent text-white font-semibold py-2 px-6 rounded-md hover:opacity-90">Submit Listing</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Property Detail Modal -->
    <div id="property-detail-modal" class="modal property-detail-modal">
        <!-- ... Detail Modal content from previous version ... -->
    </div>


    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // --- GLOBAL VARIABLES & CONSTANTS ---
        const USD_EXCHANGE_RATE = 36.5;

        // --- DOM ELEMENT SELECTORS ---
        const loadingOverlay = document.getElementById('loading-overlay');
        const notificationElement = document.getElementById('notification');
        const currencyToggleButton = document.getElementById('currency-toggle');
        const allPageSections = document.querySelectorAll('.page-content-section');
        const navLinks = document.querySelectorAll('.nav-link');
        const propertiesGrid = document.getElementById('properties-grid');
        
        // Modal & Form Elements
        const addListingBtn = document.getElementById('add-listing-btn');
        const openListingFormBtn = document.getElementById('open-listing-form-from-page');
        const addListingModal = document.getElementById('add-listing-modal');
        const cancelListingBtn = document.getElementById('cancel-listing-btn');
        const submitPropertyForm = document.getElementById('submit-property-form');
        const propertyImageInput = document.getElementById('listing-image-files');
        const imagePreviewContainer = document.getElementById('image-preview');

        // ROI Calculator Elements
        const roiInvestmentInput = document.getElementById('investment');
        const roiIncomeInput = document.getElementById('income');
        const roiExpensesInput = document.getElementById('expenses');
        const roiResultBox = document.getElementById('roi-result');

        // --- STATE VARIABLES ---
        let isTHB = true;
        let currentDetailImages = [];
        let currentImageIndex = 0;
        let roiChartInstance = null;
        let notificationTimeout;
        
        // --- DATA ---
        let propertiesData = [
            // Sample Data
             {
                id: 'villa-kamala-1', title: 'Luxury Beachfront Villa', location: 'Kamala Beach', type: 'Sale',
                bedrooms: 4, bathrooms: 5, area: 350, priceTHB: 45000000,
                description: 'Stunning luxury villa on Kamala Beach with breathtaking sea views.',
                facilities: ['Large Private Pool', 'Beach Access', 'Fully Equipped Kitchen', '24/7 Security'],
                images: ['https://placehold.co/800x600/4db6ac/ffffff?text=Luxury+Villa+1', 'https://placehold.co/800x600/4db6ac/ffffff?text=Luxury+Villa+2'],
                agentContact: '+66123456789'
            }
        ];

        // --- FUNCTIONS ---

        /**
         * Shows a notification message.
         * @param {string} message - The message to display.
         * @param {string} type - 'success' or 'error'.
         */
        function showNotification(message, type = 'success') {
            clearTimeout(notificationTimeout);
            notificationElement.textContent = message;
            notificationElement.className = ``; // Reset classes
            notificationElement.classList.add('show', type);
            notificationTimeout = setTimeout(() => {
                notificationElement.classList.remove('show');
            }, 4000);
        }
        
        /**
         * Handles SPA-like navigation.
         */
        function showPage(pageId) {
            allPageSections.forEach(section => {
                section.classList.toggle('active', section.id === pageId);
            });
             const targetSection = document.getElementById(pageId);
             if(targetSection) targetSection.scrollIntoView();
        }

        /**
         * Renders property cards.
         */
        function renderPropertyCards(propertiesToRender) {
             // Implementation from previous version
             // Ensure this function calls attachViewDetailsListeners() and updateCurrencyDisplay()
        }
        
        /**
         * Toggles the currency between THB and USD.
         */
        function toggleCurrency() {
            isTHB = !isTHB;
            document.getElementById('current-currency').textContent = isTHB ? 'THB' : 'USD';
            // updateCurrencyDisplay() needs to be called to update prices on the page
        }

        /**
         * Handles image preview for the listing form.
         */
        function handleImagePreview(event) {
            imagePreviewContainer.innerHTML = '';
            const files = event.target.files;
            if (files.length > 15) {
                showNotification('You can only upload a maximum of 15 images.', 'error');
                event.target.value = ''; // Clear selected files
                return;
            }
            Array.from(files).forEach(file => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    imagePreviewContainer.appendChild(img);
                };
                reader.readAsDataURL(file);
            });
        }
        
        /**
         * Handles the submission of the new property form.
         */
        async function handlePropertySubmit(event) {
            event.preventDefault();
            const form = event.target;
            const title = form['listing-title'].value;
            const price = parseFloat(form['listing-price'].value);
            // ... get other form values
            
            const imageFiles = propertyImageInput.files;
            const imagePromises = Array.from(imageFiles).map(file => {
                return new Promise((resolve) => {
                    const reader = new FileReader();
                    reader.onload = (e) => resolve(e.target.result);
                    reader.readAsDataURL(file);
                });
            });

            const images = await Promise.all(imagePromises);

            const newProperty = {
                id: `prop-${Date.now()}`,
                title, priceTHB: price, images,
                // ... other property fields
            };

            propertiesData.push(newProperty);
            renderPropertyCards(propertiesData);
            showNotification('Property submitted successfully!', 'success');
            hideModal(addListingModal);
        }

        /**
         * Calculates ROI and updates the chart and text.
         */
        function calculateROI() {
            const investment = parseFloat(roiInvestmentInput.value) || 0;
            const monthlyIncome = parseFloat(roiIncomeInput.value) || 0;
            const annualExpenses = parseFloat(roiExpensesInput.value) || 0;

            if (investment <= 0) {
                roiResultBox.textContent = 'Please enter a valid investment amount.';
                if(roiChartInstance) roiChartInstance.destroy();
                return;
            }

            const annualIncome = monthlyIncome * 12;
            const netProfit = annualIncome - annualExpenses;
            const roi = (netProfit / investment) * 100;

            roiResultBox.textContent = `Estimated ROI: ${roi.toFixed(2)}%`;
            
            const ctx = document.getElementById('roiChart').getContext('2d');
            if (roiChartInstance) {
                roiChartInstance.destroy();
            }
            
            roiChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Net Profit', 'Annual Expenses'],
                    datasets: [{
                        data: [netProfit > 0 ? netProfit : 0, annualExpenses],
                        backgroundColor: ['#26a69a', '#d7ccc8'],
                        borderColor: ['#ffffff', '#ffffff'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' },
                        title: { display: true, text: 'Annual Income Breakdown' }
                    }
                }
            });
        }
        
        /**
         * Generic function to show a modal.
         */
        function showModal(modalElement) {
            modalElement.classList.add('active');
            modalElement.classList.remove('leaving');
        }

        /**
         * Generic function to hide a modal with animation.
         */
        function hideModal(modalElement) {
            modalElement.classList.add('leaving');
            setTimeout(() => {
                modalElement.classList.remove('active', 'leaving');
            }, 300);
        }

        // --- EVENT LISTENERS ---

        window.addEventListener('load', () => setTimeout(() => document.getElementById('loading-overlay')?.classList.add('hidden'), 500));
        
        navLinks.forEach(link => {
            link.addEventListener('click', (event) => {
                event.preventDefault();
                const pageId = link.getAttribute('href').substring(1);
                showPage(pageId);
                history.pushState({page: pageId}, '', `#${pageId}`);
            });
        });

        window.addEventListener('popstate', (event) => {
            const pageId = event.state?.page || 'hero-section';
            showPage(pageId);
        });
        
        currencyToggleButton.addEventListener('click', toggleCurrency);

        // ROI Calculator Listeners
        [roiInvestmentInput, roiIncomeInput, roiExpensesInput].forEach(input => {
            input.addEventListener('input', calculateROI);
        });

        // Add Listing Modal Listeners
        addListingBtn.addEventListener('click', () => showModal(addListingModal));
        openListingFormBtn.addEventListener('click', () => showModal(addListingModal));
        cancelListingBtn.addEventListener('click', () => hideModal(addListingModal));
        addListingModal.addEventListener('click', (e) => { if (e.target === addListingModal) hideModal(addListingModal); });
        propertyImageInput.addEventListener('change', handleImagePreview);
        submitPropertyForm.addEventListener('submit', handlePropertySubmit);


        // --- INITIALIZATION CALLS ---
        showPage(window.location.hash.substring(1) || 'hero-section');
        renderPropertyCards(propertiesData);
        calculateROI(); // Initial calculation for the chart
    });
    </script>
</body>
</html>
