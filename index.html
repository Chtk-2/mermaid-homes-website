import React, { useState, useEffect, useCallback, useMemo } from 'react';

// Data can be moved to separate files in a real application
const initialPropertiesData = [
    { id: 'anchan-11012', title: 'Anchan Luxury Villas', type: 'Sale', category: 'Villa', location: 'Thalang', bedrooms: 3, bathrooms: 4, area: 473, priceTHB: 32837000, description: 'Experience ultimate luxury at Anchan Villa...', agentCode: 'AG-PROJ-01', images: ['https://raw.githubusercontent.com/wix-media/wix-media-entries/main/wix-media-entries/Anchan1%20(1).jpg', 'https://raw.githubusercontent.com/wix-media/wix-media-entries/main/wix-media-entries/Anchan2.jpg'] },
    { id: 'trichada-rent', title: 'Trichada Pool Villa', type: 'Rent', category: 'Villa', location: 'Bangtao Beach', bedrooms: 3, bathrooms: 2, area: 200, priceTHB: 170000, description: 'Spacious 3-bedroom pool villa, move-in ready!', agentCode: 'AG-RENT-02', images: ['https://raw.githubusercontent.com/wix-media/wix-media-entries/main/wix-media-entries/T0.jpg', 'https://raw.githubusercontent.com/wix-media/wix-media-entries/main/wix-media-entries/T1.jpg'] },
    { id: 'botanica-grand', title: 'Botanica Grand Avenue', type: 'Sale', category: 'Villa', location: 'Cherngtalay', bedrooms: 4, bathrooms: 5, area: 520, priceTHB: 58100000, description: 'The epitome of opulence by Botanica Luxury Villas.', agentCode: 'AG-PROJ-03', images: ['https://placehold.co/800x600/a1887f/ffffff?text=Botanica+1'] },
    { id: 'the-luxe-villa', title: 'The Luxe Villa', location: 'Cherngtalay', type: 'Sale', category: 'Villa', bedrooms: 5, bathrooms: 6, area: 500, priceTHB: 50000000, description: 'An exquisite villa offering unparalleled luxury and modern design.', agentCode: 'AG-LUXE-01', images: ['https://placehold.co/800x600/5d4037/ffffff?text=The+Luxe+Villa+1'] },
    { id: 'the-base-height', title: 'The Base Height Condo', type: 'Sale', category: 'Condo', location: 'Phuket Town', bedrooms: 1, bathrooms: 1, area: 34, priceTHB: 2500000, description: 'Modern condo in the heart of Phuket Town.', agentCode: 'AG-SALE-05', images: ['https://placehold.co/800x600/455a64/ffffff?text=Condo+1'] }
];

const translations = {
    en: { nav_contact: 'Contact', contact_title: 'Get In Touch', contact_subtitle: 'We are here to help you. Contact us via phone, email, or our social media channels.', contact_phone: 'Phone', contact_whatsapp: 'WhatsApp', contact_whatsapp_text: 'Chat with us', contact_email: 'Email', loading: 'Loading...', nav_properties: 'Properties', nav_roi: 'ROI Calculator', nav_post_property: 'Post Property', hero_search_placeholder: 'Enter area, building, or community', search_btn: 'Search', properties_title: 'Property Listings', filter_location: 'Location', filter_all_areas: 'All Areas', filter_category: 'Category', filter_all_categories: 'All Categories', filter_type: 'Type', filter_all_types: 'All Types', filter_for_sale: 'For Sale', filter_for_rent: 'For Rent', filter_bedrooms: 'Bedrooms', filter_any: 'Any', filter_max_price: 'Max Price', post_property_title: 'Post Your Property', post_property_desc: "Ready to list your property? Click the floating '+' button...", open_listing_form_btn: 'Open Listing Form', roi_title: 'ROI Calculator', roi_investment: 'Total Investment', roi_investment_placeholder: 'e.g. 10,000,000', roi_income: 'Monthly Rental Income', roi_income_placeholder: 'e.g. 50,000', roi_expenses: 'Annual Expenses', roi_expenses_placeholder: 'e.g. 60,000', modal_add_listing_title: 'Post a Property', form_title: 'Title', form_title_placeholder: 'e.g., Luxury Sea View Villa', form_description: 'Description', form_description_placeholder: 'e.g., A beautiful villa with a stunning ocean view...', form_price: 'Price (THB)', form_price_placeholder: '25000000', form_agent_code: 'Agent Code', form_agent_code_placeholder: 'e.g., AG-12345', form_images: 'Images (Max 15)', cancel_btn: 'Cancel', submit_btn: 'Submit Listing', delete_confirm_title: 'Confirm Deletion', delete_confirm_text: 'Are you sure you want to delete this property? Enter password to confirm.', password_label: 'Password', confirm_delete_btn: 'Confirm Delete', beds: "Beds", baths: "Baths", roi_label: 'ROI', net_profit_label: 'Net Profit', expenses_label: 'Expenses', no_properties_found: 'No properties match your criteria.', month_short: 'mo' },
    th: { nav_contact: 'ติดต่อเรา', contact_title: 'ติดต่อเรา', contact_subtitle: 'เราพร้อมที่จะช่วยเหลือคุณ ติดต่อเราผ่านทางโทรศัพท์ อีเมล หรือช่องทางโซเชียลมีเดียของเรา', contact_phone: 'โทรศัพท์', contact_whatsapp: 'WhatsApp', contact_whatsapp_text: 'แชทกับเรา', contact_email: 'อีเมล', loading: 'กำลังโหลด...', nav_properties: 'รายการอสังหาฯ', nav_roi: 'คำนวณ ROI', nav_post_property: 'ลงประกาศ', hero_search_placeholder: 'ค้นหาจากพื้นที่...', search_btn: 'ค้นหา', properties_title: 'รายการอสังหาริมทรัพย์', filter_location: 'ทำเล', filter_all_areas: 'ทุกพื้นที่', filter_category: 'หมวดหมู่', filter_all_categories: 'ทุกหมวดหมู่', filter_type: 'ประเภท', filter_all_types: 'ทุกประเภท', filter_for_sale: 'สำหรับขาย', filter_for_rent: 'สำหรับเช่า', filter_bedrooms: 'ห้องนอน', filter_any: 'ทั้งหมด', filter_max_price: 'ราคาสูงสุด', post_property_title: 'ลงประกาศของคุณ', post_property_desc: "พร้อมลงประกาศทรัพย์สินของคุณ? คลิกปุ่ม '+' เพื่อเปิดฟอร์ม", open_listing_form_btn: 'เปิดฟอร์มลงประกาศ', roi_title: 'คำนวณผลตอบแทน (ROI)', roi_investment: 'เงินลงทุนทั้งหมด', roi_investment_placeholder: 'เช่น 10,000,000', roi_income: 'รายได้ค่าเช่าต่อเดือน', roi_income_placeholder: 'เช่น 50,000', roi_expenses: 'ค่าใช้จ่ายต่อปี', roi_expenses_placeholder: 'เช่น 60,000', modal_add_listing_title: 'ลงประกาศอสังหาริมทรัพย์', form_title: 'ชื่อประกาศ', form_title_placeholder: 'เช่น วิลล่าสุดหรูวิวทะเล', form_description: 'รายละเอียด', form_description_placeholder: 'เช่น วิลล่าที่สวยงามพร้อมวิวทะเล...', form_price: 'ราคา (บาท)', form_price_placeholder: '25000000', form_agent_code: 'รหัสตัวแทน', form_agent_code_placeholder: 'เช่น AG-12345', form_images: 'รูปภาพ (สูงสุด 15 รูป)', cancel_btn: 'ยกเลิก', submit_btn: 'ลงประกาศ', delete_confirm_title: 'ยืนยันการลบ', delete_confirm_text: 'คุณแน่ใจหรือไม่ว่าต้องการลบรายการนี้? กรุณาใส่รหัสผ่านเพื่อยืนยัน', password_label: 'รหัสผ่าน', confirm_delete_btn: 'ยืนยันการลบ', beds: "ห้องนอน", baths: "ห้องน้ำ", roi_label: 'ผลตอบแทน', net_profit_label: 'กำไรสุทธิ', expenses_label: 'ค่าใช้จ่าย', no_properties_found: 'ไม่พบรายการที่ตรงกับเงื่อนไข', month_short: 'ด' }
};

// Main App Component
export default function App() {
    // STATE MANAGEMENT
    const [isLoading, setIsLoading] = useState(true);
    const [activePage, setActivePage] = useState('hero-section');
    const [properties, setProperties] = useState(initialPropertiesData);
    const [currentLang, setCurrentLang] = useState('en');
    const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
    
    // MODAL STATES
    const [isAddModalOpen, setAddModalOpen] = useState(false);
    const [isDetailModalOpen, setDetailModalOpen] = useState(false);
    const [isDeleteModalOpen, setDeleteModalOpen] = useState(false);
    const [selectedProperty, setSelectedProperty] = useState(null);
    const [propertyToDelete, setPropertyToDelete] = useState(null);

    // FILTER STATES
    const [filters, setFilters] = useState({
        location: '',
        category: '',
        type: '',
        bedrooms: '',
        maxPrice: ''
    });

    // TRANSLATION HELPER
    const t = useCallback((key) => translations[currentLang][key] || key, [currentLang]);

    // DERIVED STATE & MEMOIZATION
    const filteredProperties = useMemo(() => {
        return properties.filter(p => {
            if (filters.location && p.location !== filters.location) return false;
            if (filters.category && p.category !== filters.category) return false;
            if (filters.type && p.type !== filters.type) return false;
            if (filters.bedrooms && p.bedrooms < parseInt(filters.bedrooms)) return false;
            if (filters.maxPrice && p.priceTHB > parseFloat(filters.maxPrice)) return false;
            return true;
        });
    }, [properties, filters]);

    // PAGE NAVIGATION
    const showPage = (pageId) => {
        setActivePage(pageId);
        window.location.hash = pageId;
        window.scrollTo(0, 0);
        setMobileMenuOpen(false);
    };

    // EFFECTS
    useEffect(() => {
        const handleHashChange = () => {
            const hash = window.location.hash.replace('#', '');
            if (hash) {
                setActivePage(hash);
            }
        };
        window.addEventListener('hashchange', handleHashChange);
        handleHashChange(); // Initial check
        
        const timer = setTimeout(() => setIsLoading(false), 500); // Simulate loading
        
        return () => {
            window.removeEventListener('hashchange', handleHashChange);
            clearTimeout(timer);
        };
    }, []);
    
    // HANDLERS
    const handleFilterChange = (e) => {
        const { name, value } = e.target;
        setFilters(prev => ({ ...prev, [name]: value }));
    };

    const handleShowDetail = (property) => {
        setSelectedProperty(property);
        setDetailModalOpen(true);
    };

    const handleDeleteRequest = (property) => {
        setPropertyToDelete(property);
        setDeleteModalOpen(true);
    };

    const confirmDelete = (password) => {
        if (password === 'mermaid2024') { // Simple password check
            setProperties(prev => prev.filter(p => p.id !== propertyToDelete.id));
            setDeleteModalOpen(false);
            setPropertyToDelete(null);
            // You can add a success notification here
        } else {
            alert('Incorrect password!'); // Replace with a better notification
        }
    };

    const handleAddProperty = (newProperty) => {
        setProperties(prev => [newProperty, ...prev]);
        setAddModalOpen(false);
    };

    // RENDER
    if (isLoading) {
        return <LoadingScreen />;
    }

    return (
        <div className="bg-gray-100">
            <Header t={t} onNavigate={showPage} currentLang={currentLang} setCurrentLang={setCurrentLang} mobileMenuOpen={mobileMenuOpen} setMobileMenuOpen={setMobileMenuOpen} />
            
            <main id="main-content">
                <Page active={activePage === 'hero-section'} id="hero-section"><HeroSection onSearch={setFilters} showPage={showPage} t={t} /></Page>
                <Page active={activePage === 'properties'} id="properties"><PropertiesSection t={t} filters={filters} onFilterChange={handleFilterChange} properties={filteredProperties} onShowDetail={handleShowDetail} onDeleteRequest={handleDeleteRequest} /></Page>
                <Page active={activePage === 'roi-calculator'} id="roi-calculator"><RoiCalculatorSection t={t} /></Page>
                <Page active={activePage === 'contact'} id="contact"><ContactSection t={t} /></Page>
                <Page active={activePage === 'post-property-listing'} id="post-property-listing"><PostPropertySection t={t} setAddModalOpen={setAddModalOpen} /></Page>
            </main>
            
            <Footer />

            <FloatingButtons setAddModalOpen={setAddModalOpen} />

            {/* MODALS */}
            {isAddModalOpen && <AddPropertyModal t={t} onClose={() => setAddModalOpen(false)} onAddProperty={handleAddProperty} />}
            {isDetailModalOpen && <PropertyDetailModal t={t} property={selectedProperty} onClose={() => setDetailModalOpen(false)} />}
            {isDeleteModalOpen && <DeleteConfirmModal t={t} onClose={() => setDeleteModalOpen(false)} onConfirm={confirmDelete} />}
        </div>
    );
}

// Sub-components for better organization

const Page = ({ active, id, children }) => (
    <section id={id} className={`page-content-section ${active ? 'active' : ''}`}>
        {children}
    </section>
);

const LoadingScreen = () => (
    <div id="loading-overlay" className="fixed top-0 left-0 w-full h-full bg-white flex flex-col items-center justify-center z-50">
        <img src="Textt1.png" alt="Mermaid Homes Logo" className="max-w-[200px]" />
    </div>
);

const Header = ({ t, onNavigate, currentLang, setCurrentLang, mobileMenuOpen, setMobileMenuOpen }) => (
    <header className="bg-white shadow-sm py-2 sticky top-0 z-40">
        <div className="container mx-auto px-4 flex justify-between items-center">
            <a href="#hero-section" onClick={(e) => { e.preventDefault(); onNavigate('hero-section'); }} className="flex items-center space-x-3">
                <img src="Textt1.png" alt="Mermaid Homes Logo" className="h-16 w-auto" />
            </a>
            <nav className="hidden md:flex items-center space-x-8 text-lg">
                <a href="#properties" onClick={(e) => { e.preventDefault(); onNavigate('properties'); }} className="text-gray-600 hover:text-gray-900">{t('nav_properties')}</a>
                <a href="#roi-calculator" onClick={(e) => { e.preventDefault(); onNavigate('roi-calculator'); }} className="text-gray-600 hover:text-gray-900">{t('nav_roi')}</a>
                <a href="#contact" onClick={(e) => { e.preventDefault(); onNavigate('contact'); }} className="text-gray-600 hover:text-gray-900">{t('nav_contact')}</a>
                <a href="#post-property-listing" onClick={(e) => { e.preventDefault(); onNavigate('post-property-listing'); }} className="text-gray-600 hover:text-gray-900">{t('nav_post_property')}</a>
            </nav>
            <div className="flex items-center">
                <div className="mr-4">
                    <button onClick={() => setCurrentLang('en')} className={`p-1 ${currentLang === 'en' ? 'font-semibold' : 'text-gray-400'}`}>EN</button>
                    <span className="text-gray-300">|</span>
                    <button onClick={() => setCurrentLang('th')} className={`p-1 ${currentLang === 'th' ? 'font-semibold' : 'text-gray-400'}`}>TH</button>
                </div>
                <button onClick={() => setMobileMenuOpen(!mobileMenuOpen)} className="md:hidden text-gray-600"><i className="fas fa-bars text-xl"></i></button>
            </div>
        </div>
        {mobileMenuOpen && (
            <div className="md:hidden bg-white border-t">
                <a href="#properties" onClick={(e) => { e.preventDefault(); onNavigate('properties'); }} className="block text-center py-3 text-gray-700 hover:bg-gray-100">{t('nav_properties')}</a>
                <a href="#roi-calculator" onClick={(e) => { e.preventDefault(); onNavigate('roi-calculator'); }} className="block text-center py-3 text-gray-700 hover:bg-gray-100">{t('nav_roi')}</a>
                <a href="#contact" onClick={(e) => { e.preventDefault(); onNavigate('contact'); }} className="block text-center py-3 text-gray-700 hover:bg-gray-100">{t('nav_contact')}</a>
                <a href="#post-property-listing" onClick={(e) => { e.preventDefault(); onNavigate('post-property-listing'); }} className="block text-center py-3 text-gray-700 hover:bg-gray-100">{t('nav_post_property')}</a>
            </div>
        )}
    </header>
);

const HeroSection = ({ onSearch, showPage, t }) => {
    // ... logic for hero search
    return <div className="hero-background">...</div>
};

const PropertiesSection = ({ t, filters, onFilterChange, properties, onShowDetail, onDeleteRequest }) => {
    // ... UI for filters and property grid
    return <div className="py-12 md:py-20 bg-gray-50">...</div>
};

const PostPropertySection = ({t, setAddModalOpen}) => (
    <div className="container mx-auto px-4 text-center py-20">
        <h2 className="text-4xl md:text-5xl font-bold text-center mb-6 text-gray-800">{t('post_property_title')}</h2>
        <p className="max-w-xl mx-auto text-gray-600 mb-8">{t('post_property_desc')}</p>
        <button onClick={() => setAddModalOpen(true)} className="bg-teal-600 text-white font-semibold py-3 px-8 rounded-md hover:bg-teal-700 transition-colors">
            {t('open_listing_form_btn')}
        </button>
    </div>
);

const RoiCalculatorSection = ({ t }) => {
    // ... logic and UI for ROI calculator
    return <div className="py-12 md:py-20 bg-white">...</div>
};

const ContactSection = ({ t }) => (
    <div className="py-12 md:py-20 bg-gray-50">
        <div className="container mx-auto px-4">
            <h2 className="text-4xl md:text-5xl font-bold text-center mb-4 text-gray-800">{t('contact_title')}</h2>
            <p className="text-center text-gray-500 mb-12 max-w-2xl mx-auto">{t('contact_subtitle')}</p>
            <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
                {/* Contact cards */}
            </div>
        </div>
    </div>
);

const Footer = () => (
    <footer className="bg-gray-800 text-white py-8">
        <div className="container mx-auto px-4 text-center">
            <div className="flex justify-center space-x-6 mb-4">
                <a href="https://www.facebook.com/profile.php?id=61551898026585" target="_blank" rel="noopener noreferrer" className="text-gray-300 hover:text-white text-2xl"><i className="fab fa-facebook-f"></i></a>
                <a href="https://www.instagram.com/merm.homes" target="_blank" rel="noopener noreferrer" className="text-gray-300 hover:text-white text-2xl"><i className="fab fa-instagram"></i></a>
            </div>
            <p className="text-sm">&copy; 2024 Mermaid Homes. All rights reserved.</p>
        </div>
    </footer>
);

const FloatingButtons = ({ setAddModalOpen }) => (
    <>
        <button onClick={() => setAddModalOpen(true)} className="add-listing-btn"><i className="fas fa-plus"></i></button>
        <a href="https://wa.me/66654765114" target="_blank" rel="noopener noreferrer" className="whatsapp-float"><i className="fab fa-whatsapp"></i></a>
    </>
);

// All Modals as separate components
const AddPropertyModal = ({ t, onClose, onAddProperty }) => { /* ... */ return <div className="modal active">...</div>; };
const PropertyDetailModal = ({ t, property, onClose }) => { /* ... */ return <div className="modal active">...</div>; };
const DeleteConfirmModal = ({ t, onClose, onConfirm }) => { /* ... */ return <div className="modal active">...</div>; };
